import { __decorate, __metadata, __param } from "tslib";
import { Injectable, NgZone, Optional, Inject } from '@angular/core';
import { BehaviorSubject } from 'rxjs';
import { MONACO_PATH } from '../interfaces';
import * as i0 from "@angular/core";
var MonacoEditorLoaderService = /** @class */ (function () {
    function MonacoEditorLoaderService(ngZone, monacoPathConfig) {
        var _this = this;
        this.ngZone = ngZone;
        this.monacoPathConfig = monacoPathConfig;
        this.isMonacoLoaded$ = new BehaviorSubject(false);
        this._monacoPath = 'assets/monaco-editor/min/vs';
        if (window.monacoEditorAlreadyInitialized) {
            ngZone.run(function () { return _this.isMonacoLoaded$.next(true); });
            return;
        }
        window.monacoEditorAlreadyInitialized = true;
        if (this.monacoPathConfig) {
            this.monacoPath = this.monacoPathConfig;
        }
        this.loadMonaco();
    }
    Object.defineProperty(MonacoEditorLoaderService.prototype, "monacoPath", {
        set: function (value) {
            if (value) {
                this._monacoPath = value;
            }
        },
        enumerable: true,
        configurable: true
    });
    MonacoEditorLoaderService.prototype.loadMonaco = function () {
        var _this = this;
        var onGotAmdLoader = function () {
            var vsPath = _this._monacoPath;
            window.amdRequire = window.require;
            var isElectron = !!_this.nodeRequire;
            var isPathUrl = vsPath.includes('http');
            if (isElectron) {
                // Restore node require in window
                window.require = _this.nodeRequire;
                if (!isPathUrl) {
                    var path = window.require('path');
                    vsPath = path.resolve(window.__dirname, _this._monacoPath);
                }
            }
            window.amdRequire.config({ paths: { vs: vsPath } });
            // Load monaco
            window.amdRequire(['vs/editor/editor.main'], function () {
                _this.ngZone.run(function () { return _this.isMonacoLoaded$.next(true); });
            }, function (error) { return console.error('Error loading monaco-editor: ', error); });
        };
        // Check if AMD loader already available
        var isAmdLoaderAvailable = !!window.amdRequire;
        if (isAmdLoaderAvailable) {
            return onGotAmdLoader();
        }
        var isElectron = !!window.require;
        if (isElectron) {
            this.addElectronFixScripts();
            this.nodeRequire = window.require;
        }
        var loaderScript = document.createElement('script');
        loaderScript.type = 'text/javascript';
        loaderScript.src = this._monacoPath + "/loader.js";
        loaderScript.addEventListener('load', onGotAmdLoader);
        document.body.appendChild(loaderScript);
    };
    MonacoEditorLoaderService.prototype.addElectronFixScripts = function () {
        var electronFixScript = document.createElement('script');
        // workaround monaco-css not understanding the environment
        var inlineScript = document.createTextNode('self.module = undefined;');
        // workaround monaco-typescript not understanding the environment
        var inlineScript2 = document.createTextNode('self.process.browser = true;');
        electronFixScript.appendChild(inlineScript);
        electronFixScript.appendChild(inlineScript2);
        document.body.appendChild(electronFixScript);
    };
    MonacoEditorLoaderService.ctorParameters = function () { return [
        { type: NgZone },
        { type: String, decorators: [{ type: Optional }, { type: Inject, args: [MONACO_PATH,] }] }
    ]; };
    MonacoEditorLoaderService.ɵprov = i0.ɵɵdefineInjectable({ factory: function MonacoEditorLoaderService_Factory() { return new MonacoEditorLoaderService(i0.ɵɵinject(i0.NgZone), i0.ɵɵinject("MONACO_PATH", 8)); }, token: MonacoEditorLoaderService, providedIn: "root" });
    MonacoEditorLoaderService = __decorate([
        Injectable({ providedIn: 'root' }),
        __param(1, Optional()), __param(1, Inject(MONACO_PATH)),
        __metadata("design:paramtypes", [NgZone, String])
    ], MonacoEditorLoaderService);
    return MonacoEditorLoaderService;
}());
export { MonacoEditorLoaderService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9uYWNvLWVkaXRvci1sb2FkZXIuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BtYXRlcmlhLXVpL25neC1tb25hY28tZWRpdG9yLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL21vbmFjby1lZGl0b3ItbG9hZGVyLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDckUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN2QyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZUFBZSxDQUFDOztBQUc1QztJQVdJLG1DQUFvQixNQUFjLEVBQTBDLGdCQUF3QjtRQUFwRyxpQkFhQztRQWJtQixXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQTBDLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBUTtRQVRwRyxvQkFBZSxHQUE2QixJQUFJLGVBQWUsQ0FBVSxLQUFLLENBQUMsQ0FBQztRQUN4RSxnQkFBVyxHQUFHLDZCQUE2QixDQUFDO1FBU2xELElBQVUsTUFBTyxDQUFDLDhCQUE4QixFQUFFO1lBQ2hELE1BQU0sQ0FBQyxHQUFHLENBQUMsY0FBTSxPQUFBLEtBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUEvQixDQUErQixDQUFDLENBQUM7WUFDbEQsT0FBTztTQUNSO1FBRUssTUFBTyxDQUFDLDhCQUE4QixHQUFHLElBQUksQ0FBQztRQUVwRCxJQUFJLElBQUksQ0FBQyxnQkFBZ0IsRUFBRTtZQUN6QixJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQztTQUN6QztRQUVELElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztJQUNwQixDQUFDO0lBbkJELHNCQUFJLGlEQUFVO2FBQWQsVUFBZSxLQUFhO1lBQ3hCLElBQUksS0FBSyxFQUFFO2dCQUNQLElBQUks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QWlCLENBQUMsQ0FBQztJQUNqRCxDQUFDOztnQkF2RTJCLE1BQU07NkNBQUcsUUFBUSxZQUFJLE1BQU0sU0FBQyxXQUFXOzs7SUFYMUQseUJBQXlCO1FBRHJDLFVBQVUsQ0FBQyxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsQ0FBQztRQVlNLFdBQUEsUUFBUSxFQUFFLENBQUEsRUFBRSxXQUFBLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQTt5Q0FBeEMsTUFBTTtPQVh6Qix5QkFBeUIsQ0FtRnJDO29DQXhGRDtDQXdGQyxBQW5GRCxJQW1GQztTQW5GWSx5QkFBeUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBOZ1pvbmUsIE9wdGlvbmFsLCBJbmplY3QgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgTU9OQUNPX1BBVEggfSBmcm9tICcuLi9pbnRlcmZhY2VzJztcblxuQEluamVjdGFibGUoeyBwcm92aWRlZEluOiAncm9vdCcgfSlcbmV4cG9ydCBjbGFzcyBNb25hY29FZGl0b3JMb2FkZXJTZXJ2aWNlIHtcbiAgICBub2RlUmVxdWlyZTogYW55O1xuICAgIGlzTW9uYWNvTG9hZGVkJDogQmVoYXZpb3JTdWJqZWN0PGJvb2xlYW4+ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxib29sZWFuPihmYWxzZSk7XG4gICAgcHJpdmF0ZSBfbW9uYWNvUGF0aCA9ICdhc3NldHMvbW9uYWNvLWVkaXRvci9taW4vdnMnO1xuXG4gICAgc2V0IG1vbmFjb1BhdGgodmFsdWU6IHN0cmluZykge1xuICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuX21vbmFjb1BhdGggPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgbmdab25lOiBOZ1pvbmUsIEBPcHRpb25hbCgpIEBJbmplY3QoTU9OQUNPX1BBVEgpIHB1YmxpYyBtb25hY29QYXRoQ29uZmlnOiBzdHJpbmcpIHtcbiAgICAgIGlmICgoPGFueT53aW5kb3cpLm1vbmFjb0VkaXRvckFscmVhZHlJbml0aWFsaXplZCkge1xuICAgICAgICBuZ1pvbmUucnVuKCgpID0+IHRoaXMuaXNNb25hY29Mb2FkZWQkLm5leHQodHJ1ZSkpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgICg8YW55PndpbmRvdykubW9uYWNvRWRpdG9yQWxyZWFkeUluaXRpYWxpemVkID0gdHJ1ZTtcblxuICAgICAgaWYgKHRoaXMubW9uYWNvUGF0aENvbmZpZykge1xuICAgICAgICB0aGlzLm1vbmFjb1BhdGggPSB0aGlzLm1vbmFjb1BhdGhDb25maWc7XG4gICAgICB9XG5cbiAgICAgIHRoaXMubG9hZE1vbmFjbygpO1xuICAgIH1cblxuICAgIGxvYWRNb25hY28oKSB7XG4gICAgICBjb25zdCBvbkdvdEFtZExvYWRlciA9ICgpID0+IHtcblxuICAgICAgICBsZXQgdnNQYXRoID0gdGhpcy5fbW9uYWNvUGF0aDtcbiAgICAgICAgKDxhbnk+d2luZG93KS5hbWRSZXF1aXJlID0gKDxhbnk+d2luZG93KS5yZXF1aXJlO1xuXG4gICAgICAgIGNvbnN0IGlzRWxlY3Ryb24gPSAhIXRoaXMubm9kZVJlcXVpcmU7XG4gICAgICAgIGNvbnN0IGlzUGF0aFVybCA9IHZzUGF0aC5pbmNsdWRlcygnaHR0cCcpO1xuXG4gICAgICAgIGlmIChpc0VsZWN0cm9uKSB7XG4gICAgICAgICAgLy8gUmVzdG9yZSBub2RlIHJlcXVpcmUgaW4gd2luZG93XG4gICAgICAgICAgKDxhbnk+d2luZG93KS5yZXF1aXJlID0gdGhpcy5ub2RlUmVxdWlyZTtcblxuICAgICAgICAgIGlmICghaXNQYXRoVXJsKSB7XG4gICAgICAgICAgICBjb25zdCBwYXRoID0gKDxhbnk+d2luZG93KS5yZXF1aXJlKCdwYXRoJyk7XG4gICAgICAgICAgICB2c1BhdGggPSBwYXRoLnJlc29sdmUoKDxhbnk+d2luZG93KS5fX2Rpcm5hbWUsIHRoaXMuX21vbmFjb1BhdGgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgICg8YW55PndpbmRvdykuYW1kUmVxdWlyZS5jb25maWcoeyBwYXRoczogeyB2czogdnNQYXRoIH0gfSk7XG5cbiAgICAgICAgLy8gTG9hZCBtb25hY29cbiAgICAgICAgKDxhbnk+d2luZG93KS5hbWRSZXF1aXJlKFsndnMvZWRpdG9yL2VkaXRvci5tYWluJ10sICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMubmdab25lLnJ1bigoKSA9PiB0aGlzLmlzTW9uYWNvTG9hZGVkJC5uZXh0KHRydWUpKTtcbiAgICAgICAgfSwgKGVycm9yKSA9PiBjb25zb2xlLmVycm9yKCdFcnJvciBsb2FkaW5nIG1vbmFjby1lZGl0b3I6ICcsIGVycm9yKSk7XG4gICAgICB9O1xuXG4gICAgICAvLyBDaGVjayBpZiBBTUQgbG9hZGVyIGFscmVhZHkgYXZhaWxhYmxlXG4gICAgICBjb25zdCBpc0FtZExvYWRlckF2YWlsYWJsZSA9ICEhKDxhbnk+d2luZG93KS5hbWRSZXF1aXJlO1xuICAgICAgaWYgKGlzQW1kTG9hZGVyQXZhaWxhYmxlKSB7XG4gICAgICAgIHJldHVybiBvbkdvdEFtZExvYWRlcigpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBpc0VsZWN0cm9uID0gISEoPGFueT53aW5kb3cpLnJlcXVpcmU7XG5cbiAgICAgIGlmIChpc0VsZWN0cm9uKSB7XG4gICAgICAgIHRoaXMuYWRkRWxlY3Ryb25GaXhTY3JpcHRzKCk7XG4gICAgICAgIHRoaXMubm9kZVJlcXVpcmUgPSAoPGFueT53aW5kb3cpLnJlcXVpcmU7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGxvYWRlclNjcmlwdDogSFRNTFNjcmlwdEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgICAgIGxvYWRlclNjcmlwdC50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7XG4gICAgICBsb2FkZXJTY3JpcHQuc3JjID0gYCR7dGhpcy5fbW9uYWNvUGF0aH0vbG9hZGVyLmpzYDtcbiAgICAgIGxvYWRlclNjcmlwdC5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgb25Hb3RBbWRMb2FkZXIpO1xuICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsb2FkZXJTY3JpcHQpO1xuICAgIH1cblxuICAgIGFkZEVsZWN0cm9uRml4U2NyaXB0cygpIHtcbiAgICAgICAgY29uc3QgZWxlY3Ryb25GaXhTY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgICAgICAgLy8gd29ya2Fyb3VuZCBtb25hY28tY3NzIG5vdCB1bmRlcnN0YW5kaW5nIHRoZSBlbnZpcm9ubWVudFxuICAgICAgICBjb25zdCBpbmxpbmVTY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnc2VsZi5tb2R1bGUgPSB1bmRlZmluZWQ7Jyk7XG4gICAgICAgIC8vIHdvcmthcm91bmQgbW9uYWNvLXR5cGVzY3JpcHQgbm90IHVuZGVyc3RhbmRpbmcgdGhlIGVudmlyb25tZW50XG4gICAgICAgIGNvbnN0IGlubGluZVNjcmlwdDIgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnc2VsZi5wcm9jZXNzLmJyb3dzZXIgPSB0cnVlOycpO1xuICAgICAgICBlbGVjdHJvbkZpeFNjcmlwdC5hcHBlbmRDaGlsZChpbmxpbmVTY3JpcHQpO1xuICAgICAgICBlbGVjdHJvbkZpeFNjcmlwdC5hcHBlbmRDaGlsZChpbmxpbmVTY3JpcHQyKTtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChlbGVjdHJvbkZpeFNjcmlwdCk7XG4gICAgfVxufVxuIl19